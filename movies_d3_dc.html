<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Worldwide Gross Visualizations about Films</title>
    <link rel="stylesheet" href="css/dc.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/dc.js" charset="utf-8"></script>

</head>
<body>
    <div id="chart1" style="margin-right:30px;"><h1>Worldwide Gross (in billions) by Year</h1></div>
    <div id="chart2" style="margin-right:30px;"><h1>Worldwide Gross (in billions) by Genre</h1></div>
	<script type="text/javascript">
        var barChart = dc.barChart('#chart1');
        var barChart2 = dc.barChart('#chart2');


        d3.json("data/movies.json", function(error, data){ 
            data.forEach(function(d){
                    // d.Year = dtgFormat.parse(d.Year);
                    d.Year = d.Year;
                    d.Worldwide_Gross_M = (+d.Worldwide_Gross_M)/1000.0;
                    d.Budget_M = +d.Budget_M;
                    d.Genre = d.Genre;
            });

            //criando um crossfilter
            var facts = crossfilter(data);

            var dateDim = facts.dimension(function(d){
                return d.Year;
            });

            var genreDim = facts.dimension(function(d){
                return d.Genre;
            });

            var grossByYearGroup = dateDim.group().reduceSum(function(d){
                return d.Worldwide_Gross_M;
            });

            var grossByGenreGroup = genreDim.group().reduceSum(function(d){
                return d.Worldwide_Gross_M;
            });

            barChart.width(1000)
                     .height(400)
                     .dimension(dateDim)
                     .x(d3.scale.ordinal().domain(['2006','2007', '2008', '2009', '2010', '2011', '2012']))
                     .xUnits(dc.units.ordinal)                     .renderHorizontalGridLines(true)
                     // .legend(dc.legend().x(650).y(10).itemHeight(13).gap(5))
                     .brushOn(false)
                     .group(grossByYearGroup, 'Bilheteria');

            barChart.xAxis().tickFormat(function (v) { return v; });

            barChart2.width(800)
                     .height(400)
                     .dimension(genreDim)
                     .x(d3.scale.ordinal().domain(['Action', 'Animation', 'Adventure', 'Drama', 'Fantasy', 'Thriller', 'Romance']))
                     .xUnits(dc.units.ordinal)
                     .renderHorizontalGridLines(true)
                     // .legend(dc.legend().x(650).y(10).itemHeight(13).gap(5))
                     .brushOn(false)
                     .group(grossByGenreGroup, 'Bilheteria');

            dc.renderAll();

		});
	</script> 

</body>
</html>